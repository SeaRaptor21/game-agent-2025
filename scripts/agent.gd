class_name Agent extends Player

const STATES = 162
const ACTIONS = 3
const REWARDS = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
const STATE_TRANSITIONS = {20: [29, 29, 29], 22: [31, 31, 31], 23: [31, 31, 31], 29: [38, 38, 39], 31: [39, 40, 41], 38: [47, 47, 47], 39: [49, 49, 49], 40: [50, 50, 50], 41: [51, 51, 51], 42: [52, 52, 52], 47: [56, 56, 57], 48: [56, 57, 58], 49: [57, 58, 59], 50: [58, 59, 60], 51: [59, 60, 60], 56: [65, 65, 66], 57: [65, 66, 67], 58: [66, 67, 68], 59: [67, 68, 69], 60: [68, 69, 69], 65: [75, 75, 75], 66: [75, 75, 75], 67: [75, 75, 77], 68: [77, 77, 78], 69: [77, 78, 78], 75: [75, 75, 75], 77: [86, 86, 87], 78: [86, 87, 87], 86: [94, 95, 96], 87: [95, 96, 96], 92: [101, 101, 101], 93: [101, 101, 101], 94: [102, 102, 102], 95: [103, 103, 103], 96: [104, 104, 104], 101: [110, 110, 110], 102: [111, 111, 111], 103: [111, 111, 111], 104: [112, 112, 112], 105: [113, 113, 113], 111: [119, 120, 121], 112: [120, 120, 120], 113: [121, 121, 121], 114: [122, 122, 122], 119: [128, 128, 129], 120: [128, 129, 130], 121: [129, 130, 131], 122: [130, 131, 132], 123: [131, 132, 132], 128: [137, 137, 138], 129: [137, 138, 139], 130: [138, 139, 140], 131: [139, 140, 141], 132: [140, 141, 141], 137: [138, 138, 138], 138: [137, 137, 137], 139: [138, 138, 138], 140: [150, 150, 150], 141: [150, 150, 150], 150: [150, 150, 150]}
const INITIAL_STATE = 23
const END_STATES = [60, 67, 75, 111, 137, 138, 150]
const WIDTH = 9

var agent = QlAgent.new(STATES, ACTIONS, REWARDS, STATE_TRANSITIONS, INITIAL_STATE, END_STATES)

func _init() -> void:
	agent.learn(1000)

func get_direction() -> float:
	return agent.next_state(get_state())%WIDTH-get_state()%WIDTH

func get_state() -> int:
	return round(position.x/16)+9*round(position.y/16)
