extends Node

# These constants are generated from Python using a string
# representation of the level. These values could be calculated
# on the fly, but since the level won't change often, this
# proved simpler. See tools/generate_agent_params.py

# The following values are generated from Python
# ==============================================

const STATES = 441
const ACTIONS = 3
const REWARDS = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, -10.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 10.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
const STATE_TRANSITIONS = {20: [29, 29, 29], 22: [31, 31, 31], 23: [31, 23, 23], 29: [38, 38, 39], 31: [39, 40, 41], 38: [47, 47, 47], 39: [49, 49, 49], 40: [50, 50, 50], 41: [51, 51, 51], 42: [52, 52, 52], 47: [56, 56, 57], 48: [56, 57, 58], 49: [57, 58, 59], 50: [58, 59, 60], 51: [59, 60, 60], 56: [65, 65, 66], 57: [65, 66, 67], 58: [66, 67, 68], 59: [67, 68, 69], 60: [68, 69, 69], 65: [65, 65, 75], 66: [75, 75, 75], 67: [75, 67, 77], 68: [77, 77, 78], 69: [77, 78, 78], 75: [75, 75, 75], 77: [86, 86, 87], 78: [86, 87, 87], 86: [94, 95, 96], 87: [95, 96, 96], 92: [101, 101, 101], 93: [101, 101, 101], 94: [102, 102, 102], 95: [103, 103, 103], 96: [104, 104, 104], 101: [110, 110, 110], 102: [111, 111, 111], 103: [111, 111, 111], 104: [112, 112, 112], 105: [113, 113, 113], 111: [119, 120, 121], 112: [120, 120, 120], 113: [121, 121, 121], 114: [122, 122, 122], 119: [128, 128, 129], 120: [128, 129, 130], 121: [129, 130, 131], 122: [130, 131, 132], 123: [131, 132, 132], 128: [137, 137, 138], 129: [137, 138, 139], 130: [138, 139, 140], 131: [139, 140, 141], 132: [140, 141, 141], 137: [137, 137, 138], 138: [137, 138, 139], 139: [138, 139, 140], 140: [139, 140, 150], 141: [150, 150, 150], 150: [158, 159, 159], 155: [164, 164, 164], 156: [155, 156, 166], 157: [166, 166, 166], 158: [166, 166, 166], 159: [167, 167, 167], 166: [175, 175, 176], 167: [175, 176, 177], 168: [176, 177, 177], 175: [184, 184, 185], 176: [184, 184, 184], 177: [185, 185, 185], 184: [192, 193, 194], 185: [193, 194, 195], 186: [194, 195, 195], 191: [200, 200, 201], 192: [200, 201, 202], 193: [201, 202, 203], 194: [202, 203, 203], 195: [203, 195, 195], 200: [209, 209, 209], 201: [209, 201, 202], 202: [201, 202, 212], 203: [212, 212, 213], 209: [218, 218, 219], 212: [220, 221, 222], 213: [221, 222, 222], 218: [227, 227, 228], 219: [227, 228, 229], 220: [228, 229, 230], 221: [229, 230, 231], 222: [230, 231, 231], 227: [236, 236, 237], 228: [236, 237, 238], 229: [237, 238, 239], 230: [238, 239, 239], 231: [239, 231, 231], 236: [245, 245, 246], 237: [245, 246, 247], 238: [246, 247, 248], 239: [247, 248, 249], 245: [254, 254, 255], 246: [254, 255, 256], 247: [255, 256, 257], 248: [256, 257, 258], 249: [257, 258, 258], 254: [263, 263, 264], 255: [263, 264, 265], 256: [264, 265, 266], 257: [265, 266, 267], 258: [266, 267, 267], 263: [263, 263, 264], 264: [263, 264, 274], 265: [274, 274, 274], 266: [274, 266, 267], 267: [266, 267, 267], 274: [282, 283, 284], 281: [289, 290, 290], 282: [290, 282, 283], 283: [282, 283, 284], 284: [283, 284, 294], 285: [294, 294, 295], 289: [298, 298, 299], 290: [298, 299, 299], 294: [302, 303, 304], 295: [303, 304, 304], 298: [307, 307, 308], 299: [307, 308, 308], 302: [311, 311, 311], 303: [311, 311, 311], 304: [312, 312, 312], 307: [316, 316, 317], 308: [316, 317, 317], 311: [320, 320, 320], 312: [322, 322, 322], 313: [321, 322, 322], 316: [325, 325, 326], 317: [325, 326, 326], 320: [329, 329, 330], 321: [329, 329, 329], 322: [330, 330, 330], 325: [334, 334, 335], 326: [334, 335, 335], 329: [338, 338, 338], 330: [340, 340, 340], 331: [339, 340, 340], 334: [343, 343, 344], 335: [343, 344, 344], 338: [347, 347, 348], 339: [347, 347, 347], 340: [348, 348, 348], 343: [352, 352, 353], 344: [352, 353, 353], 347: [356, 356, 357], 348: [356, 357, 358], 349: [357, 358, 358], 352: [361, 361, 362], 353: [361, 362, 362], 356: [365, 365, 366], 357: [365, 366, 367], 358: [366, 367, 367], 361: [370, 370, 371], 362: [370, 371, 372], 365: [373, 374, 375], 366: [374, 375, 376], 367: [375, 376, 376], 370: [379, 379, 380], 371: [379, 380, 381], 372: [380, 381, 382], 373: [381, 382, 383], 374: [382, 383, 384], 375: [383, 384, 385], 376: [384, 385, 385], 379: [379, 379, 380], 380: [379, 380, 381], 381: [380, 381, 391], 382: [391, 391, 391], 383: [391, 383, 384], 384: [383, 384, 385], 385: [384, 385, 385], 391: [399, 400, 401], 398: [407, 407, 408], 399: [407, 408, 409], 400: [408, 409, 410], 401: [409, 410, 411], 402: [410, 411, 411], 407: [416, 416, 417], 408: [416, 417, 418], 409: [417, 418, 419], 410: [418, 419, 420], 411: [419, 420, 420], 416: [416, 416, 417], 417: [416, 417, 427], 418: [427, 427, 427], 419: [427, 419, 420], 420: [419, 420, 420], 427: [427, 427, 427]}
const INITIAL_STATE = 23
const END_STATES = [60, 67, 75, 111, 137, 138, 156, 166, 175, 184, 195, 201, 202, 231, 263, 266, 267, 307, 313, 320, 326, 331, 338, 343, 349, 356, 362, 379, 385, 427]
const WIDTH = 9
const TILE_SIZE = 16
const EPSILON = 0.8

# Create an agent
var agent = QlAgent.new(STATES, ACTIONS, REWARDS, STATE_TRANSITIONS, INITIAL_STATE, END_STATES)
var total_episodes = 0 # Used for the training splash screen

func _ready() -> void:
	randomize() # Set a random seed for the project
